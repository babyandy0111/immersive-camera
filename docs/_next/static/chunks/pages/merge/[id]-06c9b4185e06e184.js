(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[829],{8575:function(e,t){var n,a;void 0!==(a="function"==typeof(n=function(){return function(e,t,n){t=t||"",n=n||512;for(var a=atob(e),o=[],i=0;i<a.length;i+=n){for(var r=a.slice(i,i+n),c=Array(r.length),l=0;l<r.length;l++)c[l]=r.charCodeAt(l);var s=new Uint8Array(c);o.push(s)}return new Blob(o,{type:t})}})?n.apply(t,[]):n)&&(e.exports=a)},8102:function(e,t,n){var a,o;void 0!==(o="function"==typeof(a=function(){"use strict";function t(e,t,n){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){c(a.response,t,n)},a.onerror=function(){console.error("could not download file")},a.send()}function a(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,r=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(e,n,r){var c=i.URL||i.webkitURL,l=document.createElement("a");n=n||e.name||"download",l.download=n,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?o(l):a(l.href)?t(e,n,r):o(l,l.target="_blank")):(l.href=c.createObjectURL(e),setTimeout(function(){c.revokeObjectURL(l.href)},4e4),setTimeout(function(){o(l)},0))}:"msSaveOrOpenBlob"in navigator?function(e,n,i){if(n=n||e.name||"download","string"!=typeof e){var r;navigator.msSaveOrOpenBlob((void 0===(r=i)?r={autoBom:!1}:"object"!=typeof r&&(console.warn("Deprecated: Expected third argument to be a object"),r={autoBom:!r}),r.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e),n)}else if(a(e))t(e,n,i);else{var c=document.createElement("a");c.href=e,c.target="_blank",setTimeout(function(){o(c)})}}:function(e,n,a,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,a);var c="application/octet-stream"===e.type,l=/constructor/i.test(i.HTMLElement)||i.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||c&&l||r)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},u.readAsDataURL(e)}else{var d=i.URL||i.webkitURL,g=d.createObjectURL(e);o?o.location=g:location.href=g,o=null,setTimeout(function(){d.revokeObjectURL(g)},4e4)}});i.saveAs=c.saveAs=c,e.exports=c})?a.apply(t,[]):a)&&(e.exports=o)},2481:function(e,t){"use strict";var n={format:"image/png",quality:.92,width:void 0,height:void 0,Canvas:void 0,crossOrigin:void 0};t.Z=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t={}),new Promise(function(a){var o=(t=Object.assign({},n,t)).Canvas?new t.Canvas:window.document.createElement("canvas"),i=t.Image||window.Image,r=e.map(function(e){return new Promise(function(n,a){"Object"!==e.constructor.name&&(e={src:e});var o=new i;o.crossOrigin=t.crossOrigin,o.onerror=function(){return a(Error("Couldn't load image"))},o.onload=function(){return n(Object.assign({},e,{img:o}))},o.src=e.src})}),c=o.getContext("2d");a(Promise.all(r).then(function(e){var n=function(n){return t[n]||Math.max.apply(Math,e.map(function(e){return e.img[n]}))};return(o.width=n("width"),o.height=n("height"),e.forEach(function(e){return c.globalAlpha=e.opacity?e.opacity:1,c.drawImage(e.img,e.x||0,e.y||0)}),t.Canvas&&"image/jpeg"===t.format)?new Promise(function(e,n){o.toDataURL(t.format,{quality:t.quality,progressive:!1},function(t,a){if(t){n(t);return}e(a)})}):o.toDataURL(t.format,t.quality)}))})}},2954:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/merge/[id]",function(){return n(8793)}])},8769:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(5893),o=n(9008),i=n.n(o),r=n(5697),c=n.n(r);function l(e){let{children:t}=e;return(0,a.jsxs)("div",{className:c().container,children:[(0,a.jsxs)(i(),{children:[(0,a.jsx)("title",{children:"新北市議會類 AR 合照系統"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width,initial-scale=1,shrink-to-fit=no"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.png"})]}),t]})}},7125:function(e,t,n){"use strict";var a=n(5893);n(7294);var o=n(8102),i=n(8575);let r={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg"},c={png:"data:".concat(r.png,";base64"),jpeg:"data:".concat(r.jpeg,";base64"),jpg:"data:".concat(r.jpg,";base64")},l="download",s=function(e){let{base64:t,children:n,downloadName:s,onDownloadSuccess:u,onDownloadError:d,Tag:g,className:f,style:h,extraAttributes:m}=e;return(0,a.jsx)(g,{...m,onClick:function(){try{(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l,n=function(e){let t;if("string"==typeof e&&(t=Object.keys(c).find(t=>0===e.indexOf(c[t]))),t)return t;throw Error("props.base64 on <Base64Downloader/> has invalid or undefined extension. expected ".concat(Object.keys(r).join(", ")))}(e),a=c[n],s=r[n],u=e.replace("".concat(a,","),""),d=i(u,s),g=new File([d],"".concat(t,".").concat(n),{type:a});o.saveAs(g)})(t,s),u&&u({base64:t})}catch(e){console.error(e),d&&d(e)}},className:f,style:h,children:n})};s.defaultProps={className:"",style:{},downloadName:l,Tag:"button",extraAttributes:{}},t.ZP=s},8793:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var a=n(5893),o=n(1163),i=n(5697),r=n.n(i),c=n(3532),l=n.n(c),s=n(8769),u=n(7294),d=n(6770),g=n.n(d),f=n(2481),h=n(7125);let m={};function p(){let e=(0,o.useRouter)(),[t,n]=(0,u.useState)(""),[i,c]=(0,u.useState)(null),[d,p]=(0,u.useState)(null),[v,w]=(0,u.useState)(9),[y,b]=(0,u.useState)(16),[j,_]=(0,u.useState)("".concat("/immersive-camera","/images/characters/port-1.png")),x=async e=>new Promise(t=>{let n=new FileReader;n.readAsDataURL(e),n.onloadend=()=>{t(n.result)}}),E=e=>{let t=e.split(";base64,"),n=t[0].split(":")[1],a=null==window?void 0:window.atob(t[1]),o=new Uint8Array(a.length);for(let e=0;e<a.length;++e)o[e]=a.charCodeAt(e);return new Blob([o],{type:n})},A=(e,t)=>new Promise(n=>{let a=new Image;a.onload=()=>{let e=a.naturalWidth,o=a.naturalHeight,i=e/o,r=e,c=o;i>t?r=o*t:i<t&&(c=e/t);let l=(r-e)*.5,s=(c-o)*.5,u=document.createElement("canvas");u.width=r,u.height=c;let d=u.getContext("2d");d.drawImage(a,l,s),n(u.toDataURL("image/jpeg"))},a.src=e}),R=(e,t,n)=>new Promise(a=>{g().imageFileResizer(e,t,n,"PNG",100,0,e=>{a(e)},"base64",t,n)}),k=async e=>{if(e.target.files){let t=await x(e.target.files[0]),n=new Image;n.onload=async()=>{let{width:e,height:a}=n,o=t;(9===v&&16===y&&e>a||16===v&&9===y&&e<a)&&(o=await A(o,v/y));let i=E(o),r=1920,l=1080;9===v&&16===y&&(r=1080,l=1920);let s=await R(i,r,l);c(s),(0,f.Z)([{src:s,x:0,y:0},{src:j,x:0,y:0}]).then(e=>{p(e)})},n.src=t}};(0,u.useEffect)(()=>{e.query.id&&n(e.query.id)},[t]);let O=()=>{let t="land";(null==m?void 0:m.innerWidth)>(null==m?void 0:m.innerHeight)?(w(16),b(9),t="land"):(w(9),b(16),t="port"),_("".concat("/immersive-camera","/images/characters/").concat(t,"-").concat(e.query.id,".png"))};return(0,u.useEffect)(()=>{void 0!==m&&(O(),m.onresize=function(){c(null),p(null),O()})},[v,y]),(0,a.jsx)(s.Z,{children:(0,a.jsxs)("main",{className:"".concat(r().main),children:[(0,a.jsx)("div",{className:l()["preview-img"],style:{backgroundImage:"url(".concat(j)}}),(0,a.jsxs)("div",{className:"".concat(r().func," ").concat(l().func," ").concat(d?l()["merged-img"]:""),children:[(0,a.jsxs)("div",{className:l()["select-file"],children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:k}),(0,a.jsx)("button",{children:"選擇照片"})]}),null!==d&&(0,a.jsx)(h.ZP,{base64:d,downloadName:"photo".concat(t),children:"下載照片"})]}),(0,a.jsx)("div",{className:l()["photo-img"],style:{backgroundImage:"".concat(i?'url("'.concat(i,'")'):"")},image:i})]})})}m=window},5697:function(e){e.exports={container:"home_container__U_vei",main:"home_main__yuqk2",func:"home_func__uVVrR",list:"home_list__xGS3_"}},3532:function(e){e.exports={func:"merge_func__zUYnD","select-file":"merge_select-file__G50AC","preview-img":"merge_preview-img__ynuJi","photo-img":"merge_photo-img__6eZfV","merged-img":"merge_merged-img___jMt_"}},9008:function(e,t,n){e.exports=n(2636)},1163:function(e,t,n){e.exports=n(6885)},6770:function(e){(()=>{"use strict";var t={d:(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},n={};t.r(n),t.d(n,{default:()=>o});var a=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"changeHeightWidth",value:function(e,t,n,a,o,i){return n>a&&(e=Math.round(e*a/n),n=a),e>t&&(n=Math.round(n*t/e),e=t),o&&n<o&&(e=Math.round(e*o/n),n=o),i&&e<i&&(n=Math.round(n*i/e),e=i),{height:e,width:n}}},{key:"resizeAndRotateImage",value:function(e,t,n,a,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"jpeg",r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:100,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=document.createElement("canvas"),s=e.width,u=e.height,d=this.changeHeightWidth(u,n,s,t,a,o);c&&(90===c||270===c)?(l.width=d.height,l.height=d.width):(l.width=d.width,l.height=d.height),s=d.width,u=d.height;var g=l.getContext("2d");return g.fillStyle="rgba(0, 0, 0, 0)",g.fillRect(0,0,s,u),g.imageSmoothingEnabled&&g.imageSmoothingQuality&&(g.imageSmoothingQuality="high"),c&&(g.rotate(c*Math.PI/180),90===c?g.translate(0,-l.width):180===c?g.translate(-l.width,-l.height):270===c?g.translate(-l.height,0):0!==c&&360!==c||g.translate(0,0)),g.drawImage(e,0,0,s,u),l.toDataURL("image/".concat(i),r/100)}},{key:"b64toByteArrays",value:function(e,t){t=t||"image/jpeg";for(var n=atob(e.toString().replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,"")),a=[],o=0;o<n.length;o+=512){for(var i=n.slice(o,o+512),r=Array(i.length),c=0;c<i.length;c++)r[c]=i.charCodeAt(c);var l=new Uint8Array(r);a.push(l)}return a}},{key:"b64toBlob",value:function(e,t){var n=this.b64toByteArrays(e,t);return new Blob(n,{type:t,lastModified:new Date})}},{key:"b64toFile",value:function(e,t,n){var a=this.b64toByteArrays(e,n);return new File(a,t,{type:n,lastModified:new Date})}},{key:"createResizedImage",value:function(e,n,a,o,i,r,c){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"base64",s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=new FileReader;if(!e)throw Error("File Not Found!");if(e.type&&!e.type.includes("image"))throw Error("File Is NOT Image!");d.readAsDataURL(e),d.onload=function(){var g=new Image;g.src=d.result,g.onload=function(){var d=t.resizeAndRotateImage(g,n,a,s,u,o,i,r),f="image/".concat(o);switch(l){case"blob":c(t.b64toBlob(d,f));break;case"base64":default:c(d);break;case"file":var h=e.name.toString().replace(/(png|jpeg|jpg|webp)$/i,"").concat(o.toString());c(t.b64toFile(d,h,f))}}},d.onerror=function(e){throw Error(e)}}}],function(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}(t,e),t}();let o={imageFileResizer:function(e,t,n,o,i,r,c,l,s,u){return a.createResizedImage(e,t,n,o,i,r,c,l,s,u)}};e.exports=n})()}},function(e){e.O(0,[774,888,179],function(){return e(e.s=2954)}),_N_E=e.O()}]);