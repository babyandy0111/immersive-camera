(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[829],{2481:function(e,t){"use strict";var n={format:"image/png",quality:.92,width:void 0,height:void 0,Canvas:void 0,crossOrigin:void 0};t.Z=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t={}),new Promise(function(i){var a=(t=Object.assign({},n,t)).Canvas?new t.Canvas:window.document.createElement("canvas"),r=t.Image||window.Image,o=e.map(function(e){return new Promise(function(n,i){"Object"!==e.constructor.name&&(e={src:e});var a=new r;a.crossOrigin=t.crossOrigin,a.onerror=function(){return i(Error("Couldn't load image"))},a.onload=function(){return n(Object.assign({},e,{img:a}))},a.src=e.src})}),c=a.getContext("2d");i(Promise.all(o).then(function(e){var n=function(n){return t[n]||Math.max.apply(Math,e.map(function(e){return e.img[n]}))};return(a.width=n("width"),a.height=n("height"),e.forEach(function(e){return c.globalAlpha=e.opacity?e.opacity:1,c.drawImage(e.img,e.x||0,e.y||0)}),t.Canvas&&"image/jpeg"===t.format)?new Promise(function(e,n){a.toDataURL(t.format,{quality:t.quality,progressive:!1},function(t,i){if(t){n(t);return}e(i)})}):a.toDataURL(t.format,t.quality)}))})}},2954:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/merge/[id]",function(){return n(8793)}])},8769:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var i=n(5893),a=n(9008),r=n.n(a),o=n(5697),c=n.n(o);function l(e){let{children:t}=e;return(0,i.jsxs)("div",{className:c().container,children:[(0,i.jsxs)(r(),{children:[(0,i.jsx)("title",{children:"新北市議會類 AR 合照系統"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width,initial-scale=1,shrink-to-fit=no"}),(0,i.jsx)("link",{rel:"icon",href:"/favicon.png"})]}),t]})}},8793:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var i=n(5893),a=n(1163),r=n(5697),o=n.n(r),c=n(3532),l=n.n(c),s=n(8769),u=n(7294),g=n(6770),d=n.n(g);n(2481);let h={};function m(){let e=(0,a.useRouter)(),[t,n]=(0,u.useState)(""),[r,c]=(0,u.useState)(null),[g,m]=(0,u.useState)(9),[f,v]=(0,u.useState)(16),[w,p]=(0,u.useState)("".concat("/immersive-camera","/images/characters/port-1.png")),y=async e=>new Promise(t=>{let n=new FileReader;n.readAsDataURL(e),n.onloadend=()=>{t(n.result)}}),b=e=>{let t=e.split(";base64,"),n=t[0].split(":")[1],i=null==window?void 0:window.atob(t[1]),a=new Uint8Array(i.length);for(let e=0;e<i.length;++e)a[e]=i.charCodeAt(e);return new Blob([a],{type:n})},_=(e,t)=>new Promise(n=>{let i=new Image;i.onload=()=>{let e=i.naturalWidth,a=i.naturalHeight,r=e/a,o=e,c=a;r>t?o=a*t:r<t&&(c=e/t);let l=(o-e)*.5,s=(c-a)*.5,u=document.createElement("canvas");u.width=o,u.height=c;let g=u.getContext("2d");g.drawImage(i,l,s),n(u.toDataURL("image/jpeg"))},i.src=e}),j=(e,t,n)=>new Promise(i=>{d().imageFileResizer(e,t,n,"PNG",100,0,e=>{i(e)},"base64",t,n)}),x=async e=>{if(e.target.files){let t=await y(e.target.files[0]),n=new Image;n.onload=async()=>{let{width:e,height:i}=n,a=t;console.log("a"),(9===g&&16===f&&e>i||16===g&&9===f&&e<i)&&(console.log("b",a,g,f),a=await _(a,g/f)),console.log("c");let r=b(a);console.log("d",r);let o=1920,l=1080;9===g&&16===f&&(o=1080,l=1920);let s=await j(r,o,l);c(s),console.log(s)},n.src=t}},k=async()=>{};(0,u.useEffect)(()=>{e.query.id&&n(e.query.id)},[t]);let R=()=>{let t="land";(null==h?void 0:h.innerWidth)>(null==h?void 0:h.innerHeight)?(m(16),v(9),t="land"):(m(9),v(16),t="port"),p("".concat("/immersive-camera","/images/characters/").concat(t,"-").concat(e.query.id,".png"))};return(0,u.useEffect)(()=>{void 0!==h&&(R(),h.onresize=function(){R()})},[g,f]),(0,i.jsx)(s.Z,{children:(0,i.jsxs)("main",{className:"".concat(o().main),children:[(0,i.jsx)("div",{className:l()["preview-img"],style:{backgroundImage:"url(".concat(w)}}),(0,i.jsxs)("div",{className:"".concat(o().func," ").concat(l().func),children:[(0,i.jsxs)("div",{className:l()["select-file"],children:[(0,i.jsx)("input",{type:"file",onChange:x}),(0,i.jsx)("button",{children:"選擇照片"})]}),(0,i.jsx)("button",{onClick:k,children:"下載照片"})]}),(0,i.jsx)("div",{className:l()["photo-img"],style:{backgroundImage:"".concat(r?'url("'.concat(r,'")'):"")},image:r,onClick:()=>{}})]})})}h=window},5697:function(e){e.exports={container:"home_container__U_vei",main:"home_main__yuqk2",func:"home_func__uVVrR",list:"home_list__xGS3_"}},3532:function(e){e.exports={func:"merge_func__zUYnD","select-file":"merge_select-file__G50AC","preview-img":"merge_preview-img__ynuJi","photo-img":"merge_photo-img__6eZfV"}},9008:function(e,t,n){e.exports=n(2636)},1163:function(e,t,n){e.exports=n(6885)},6770:function(e){(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},n={};t.r(n),t.d(n,{default:()=>a});var i=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"changeHeightWidth",value:function(e,t,n,i,a,r){return n>i&&(e=Math.round(e*i/n),n=i),e>t&&(n=Math.round(n*t/e),e=t),a&&n<a&&(e=Math.round(e*a/n),n=a),r&&e<r&&(n=Math.round(n*r/e),e=r),{height:e,width:n}}},{key:"resizeAndRotateImage",value:function(e,t,n,i,a){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"jpeg",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:100,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=document.createElement("canvas"),s=e.width,u=e.height,g=this.changeHeightWidth(u,n,s,t,i,a);c&&(90===c||270===c)?(l.width=g.height,l.height=g.width):(l.width=g.width,l.height=g.height),s=g.width,u=g.height;var d=l.getContext("2d");return d.fillStyle="rgba(0, 0, 0, 0)",d.fillRect(0,0,s,u),d.imageSmoothingEnabled&&d.imageSmoothingQuality&&(d.imageSmoothingQuality="high"),c&&(d.rotate(c*Math.PI/180),90===c?d.translate(0,-l.width):180===c?d.translate(-l.width,-l.height):270===c?d.translate(-l.height,0):0!==c&&360!==c||d.translate(0,0)),d.drawImage(e,0,0,s,u),l.toDataURL("image/".concat(r),o/100)}},{key:"b64toByteArrays",value:function(e,t){t=t||"image/jpeg";for(var n=atob(e.toString().replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,"")),i=[],a=0;a<n.length;a+=512){for(var r=n.slice(a,a+512),o=Array(r.length),c=0;c<r.length;c++)o[c]=r.charCodeAt(c);var l=new Uint8Array(o);i.push(l)}return i}},{key:"b64toBlob",value:function(e,t){var n=this.b64toByteArrays(e,t);return new Blob(n,{type:t,lastModified:new Date})}},{key:"b64toFile",value:function(e,t,n){var i=this.b64toByteArrays(e,n);return new File(i,t,{type:n,lastModified:new Date})}},{key:"createResizedImage",value:function(e,n,i,a,r,o,c){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"base64",s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=new FileReader;if(!e)throw Error("File Not Found!");if(e.type&&!e.type.includes("image"))throw Error("File Is NOT Image!");g.readAsDataURL(e),g.onload=function(){var d=new Image;d.src=g.result,d.onload=function(){var g=t.resizeAndRotateImage(d,n,i,s,u,a,r,o),h="image/".concat(a);switch(l){case"blob":c(t.b64toBlob(g,h));break;case"base64":default:c(g);break;case"file":var m=e.name.toString().replace(/(png|jpeg|jpg|webp)$/i,"").concat(a.toString());c(t.b64toFile(g,m,h))}}},g.onerror=function(e){throw Error(e)}}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();let a={imageFileResizer:function(e,t,n,a,r,o,c,l,s,u){return i.createResizedImage(e,t,n,a,r,o,c,l,s,u)}};e.exports=n})()}},function(e){e.O(0,[774,888,179],function(){return e(e.s=2954)}),_N_E=e.O()}]);