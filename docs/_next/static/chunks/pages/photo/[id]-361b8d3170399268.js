(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{3640:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/photo/[id]",function(){return t(4701)}])},4701:function(e,a,t){"use strict";t.r(a);var n=t(5893),i=t(7294),o=t(1894),c=t.n(o),s=t(3041),r=t(6770),l=t.n(r),d=t(2481),u=t(1163);let h=[];h=window,a.default=()=>{let[e,a]=(0,i.useState)(0),[t,o]=(0,i.useState)(null),[r,m]=(0,i.useState)(!1),g=(0,i.useRef)(null),[p,v]=(0,i.useState)([]),[_,b]=(0,i.useState)(void 0),[w,f]=(0,i.useState)("block"),y=(0,u.useRouter)(),[k,x]=(0,i.useState)(""),N=async e=>{let a=await fetch(e),t=await a.blob(),n="";return await new Promise(e=>{let a=new FileReader;a.readAsDataURL(t),a.onloadend=()=>{e(n=a.result)}}),n},j=e=>{let a=e.split(";base64,"),t=a[0].split(":")[1],n=null==h?void 0:h.atob(a[1]),i=new Uint8Array(n.length);for(let e=0;e<n.length;++e)i[e]=n.charCodeAt(e);return new Blob([i],{type:t})},C=(e,a,t)=>new Promise(n=>{l().imageFileResizer(e,a,t,"PNG",100,0,e=>{n(e)},"base64",a,t)});return(0,i.useEffect)(()=>{(async()=>{let e=await navigator.mediaDevices.enumerateDevices(),a=e.filter(e=>"videoinput"==e.kind);v(a)})()}),(0,i.useEffect)(()=>{y.query.id&&x(y.query.id),console.log(k)},[k]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{id:"img_head_back",children:(0,n.jsxs)("div",{className:c().wrapper,children:[r?(0,n.jsx)("div",{className:c()["full-screen-image-preview"],style:{backgroundImage:"".concat(t?'url("'.concat(t,'")'):"")},image:t,onClick:()=>{m(!r),f("none"===w?"block":"none")}}):(0,n.jsx)(s.V,{ref:g,facingMode:"environment",aspectRatio:"cover",numberOfCamerasCallback:e=>a(e),videoSourceDeviceId:_,errorMessages:{noCameraAccessible:"No camera device accessible. Please connect your camera or try a different browser.",permissionDenied:"Permission denied. Please refresh and give camera permission.",switchCamera:"It is not possible to switch camera to different one because there is only one video device accessible.",canvas:"Canvas is not supported."},videoReadyCallback:()=>{console.log("Video feed ready.")}}),"block"===w&&(0,n.jsx)("div",{id:"img_head",className:c()["image-head"],children:(null==h?void 0:h.innerWidth)>(null==h?void 0:h.innerHeight)?(0,n.jsx)("img",{src:"".concat("/immersive-camera")+"/images/characters/land-"+k+".png",alt:"test",style:{width:(null==h?void 0:h.innerWidth)-130,height:null==h?void 0:h.innerHeight}}):(0,n.jsx)("img",{src:"".concat("/immersive-camera")+"/images/characters/port-"+k+".png",alt:"test",style:{width:null==h?void 0:h.innerWidth}})}),(0,n.jsxs)("div",{className:c().control,children:[(0,n.jsx)("select",{style:{display:"none"},onChange:e=>{b(e.target.value)},children:p.map(e=>(0,n.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))}),(0,n.jsx)("div",{className:c()["image-preview"],style:{backgroundImage:"".concat(t?'url("'.concat(t,'")'):"")},image:t,onClick:()=>{m(!r),f("none"===w?"block":"none")}}),(0,n.jsx)("div",{className:"".concat(c().button," ").concat(c()["take-photo-button"]),onClick:async()=>{if(g.current){let e="".concat("/immersive-camera")+"/images/characters/",a="",t=g.current.takePhoto(),n=new Image;n.onload=async()=>{a=n.width>n.height?e+"land-"+k+".png":e+"port-"+k+".png";let i=await N(a),c=j(i);try{let e=await C(c,n.width,n.height);(0,d.Z)([{src:t,x:0,y:0},{src:e,x:0,y:0}]).then(e=>{o(e)})}catch(e){console.log(e)}},n.src=t}}}),(0,n.jsx)("div",{className:"".concat(c().button," ").concat(c()["change-facing-camera-button"]),style:{visibility:"hidden"},disabled:e<=1,onClick:()=>{if(g.current){let e=g.current.switchCamera();console.log(e)}}})]})]})})})}},1894:function(e){e.exports={wrapper:"photo_wrapper__IpDW7","image-head":"photo_image-head__x_be_",control:"photo_control__zYJLd",button:"photo_button__iIxWf","take-photo-button":"photo_take-photo-button__7HxNy","change-facing-camera-button":"photo_change-facing-camera-button__GK3jp","image-preview":"photo_image-preview__NhJsK","full-screen-image-preview":"photo_full-screen-image-preview__K6WRY"}}},function(e){e.O(0,[78,774,888,179],function(){return e(e.s=3640)}),_N_E=e.O()}]);