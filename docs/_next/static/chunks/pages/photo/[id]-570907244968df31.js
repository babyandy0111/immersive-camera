(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{3640:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/photo/[id]",function(){return a(4701)}])},4701:function(e,t,a){"use strict";a.r(t);var n=a(5893),i=a(7294),o=a(1894),s=a.n(o),c=a(3041),r=a(6770),l=a.n(r),d=a(2481),u=a(1163);let h=[];h=window,t.default=()=>{let[e,t]=(0,i.useState)(0),[a,o]=(0,i.useState)(null),[r,g]=(0,i.useState)(!1),m=(0,i.useRef)(null),[p,v]=(0,i.useState)([]),[_,b]=(0,i.useState)(void 0),[w,f]=(0,i.useState)("block"),y=(0,u.useRouter)(),[k,x]=(0,i.useState)(""),N=async e=>{let t=await fetch(e),a=await t.blob(),n="";return await new Promise(e=>{let t=new FileReader;t.readAsDataURL(a),t.onloadend=()=>{e(n=t.result)}}),n},j=e=>{let t=e.split(";base64,"),a=t[0].split(":")[1],n=null==h?void 0:h.atob(t[1]),i=new Uint8Array(n.length);for(let e=0;e<n.length;++e)i[e]=n.charCodeAt(e);return new Blob([i],{type:a})},C=(e,t,a)=>new Promise(n=>{l().imageFileResizer(e,t,a,"PNG",100,0,e=>{n(e)},"base64",t,a)});return(0,i.useEffect)(()=>{(async()=>{let e=await navigator.mediaDevices.enumerateDevices(),t=e.filter(e=>"videoinput"==e.kind);v(t)})()}),(0,i.useEffect)(()=>{y.query.id&&x(y.query.id),console.log(k)},[k]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{id:"img_head_back",children:(0,n.jsxs)("div",{className:s().wrapper,children:[r?(0,n.jsx)("div",{className:s()["full-screen-image-preview"],style:{backgroundImage:"".concat(a?'url("'.concat(a,'")'):"")},image:a,onClick:()=>{g(!r),f("none"===w?"block":"none")}}):(0,n.jsx)(c.V,{ref:m,facingMode:"environment",aspectRatio:"cover",numberOfCamerasCallback:e=>t(e),videoSourceDeviceId:_,errorMessages:{noCameraAccessible:"No camera device accessible. Please connect your camera or try a different browser.",permissionDenied:"Permission denied. Please refresh and give camera permission.",switchCamera:"It is not possible to switch camera to different one because there is only one video device accessible.",canvas:"Canvas is not supported."},videoReadyCallback:()=>{console.log("Video feed ready.")}}),"block"===w&&(0,n.jsx)("div",{id:"img_head",className:s()["image-head"],children:(null==h?void 0:h.innerWidth)>(null==h?void 0:h.innerHeight)?(0,n.jsx)("img",{src:"/images/characters/land-"+k+".png",alt:"test",style:{width:(null==h?void 0:h.innerWidth)-130,height:null==h?void 0:h.innerHeight}}):(0,n.jsx)("img",{src:"/images/characters/port-"+k+".png",alt:"test",style:{width:null==h?void 0:h.innerWidth}})}),(0,n.jsxs)("div",{className:s().control,children:[(0,n.jsx)("select",{style:{display:"none"},onChange:e=>{b(e.target.value)},children:p.map(e=>(0,n.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))}),(0,n.jsx)("div",{className:s()["image-preview"],style:{backgroundImage:"".concat(a?'url("'.concat(a,'")'):"")},image:a,onClick:()=>{g(!r),f("none"===w?"block":"none")}}),(0,n.jsx)("div",{className:"".concat(s().button," ").concat(s()["take-photo-button"]),onClick:async()=>{if(m.current){let e="/images/characters/",t="",a=m.current.takePhoto(),n=new Image;n.onload=async()=>{t=n.width>n.height?e+"land-"+k+".png":e+"port-"+k+".png";let i=await N(t),s=j(i);try{let e=await C(s,n.width,n.height);(0,d.Z)([{src:a,x:0,y:0},{src:e,x:0,y:0}]).then(e=>{o(e)})}catch(e){console.log(e)}},n.src=a}}}),(0,n.jsx)("div",{className:"".concat(s().button," ").concat(s()["change-facing-camera-button"]),style:{visibility:"hidden"},disabled:e<=1,onClick:()=>{if(m.current){let e=m.current.switchCamera();console.log(e)}}})]})]})})})}},1894:function(e){e.exports={wrapper:"photo_wrapper__IpDW7","image-head":"photo_image-head__x_be_",control:"photo_control__zYJLd",button:"photo_button__iIxWf","take-photo-button":"photo_take-photo-button__7HxNy","change-facing-camera-button":"photo_change-facing-camera-button__GK3jp","image-preview":"photo_image-preview__NhJsK","full-screen-image-preview":"photo_full-screen-image-preview__K6WRY"}}},function(e){e.O(0,[78,774,888,179],function(){return e(e.s=3640)}),_N_E=e.O()}]);