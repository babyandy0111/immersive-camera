(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{3640:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/photo/[id]",function(){return a(4701)}])},4701:function(e,t,a){"use strict";a.r(t);var n=a(5893),i=a(7294),o=a(1894),c=a.n(o),s=a(3041),r=a(6770),l=a.n(r),d=a(2481),u=a(1163);let h=[];h=window,t.default=()=>{let[e,t]=(0,i.useState)(0),[a,o]=(0,i.useState)(null),[r,m]=(0,i.useState)(!1),g=(0,i.useRef)(null),[p,_]=(0,i.useState)([]),[v,w]=(0,i.useState)(void 0),[b,f]=(0,i.useState)("block"),y=(0,u.useRouter)(),[k,x]=(0,i.useState)(""),[C,N]=(0,i.useState)(9),[j,I]=(0,i.useState)(16),[S,P]=(0,i.useState)("".concat("/immersive-camera","/images/characters/port-1.png")),E=async e=>{let t=await fetch(e),a=await t.blob(),n="";return await new Promise(e=>{let t=new FileReader;t.readAsDataURL(a),t.onloadend=()=>{e(n=t.result)}}),n},R=e=>{let t=e.split(";base64,"),a=t[0].split(":")[1],n=null==h?void 0:h.atob(t[1]),i=new Uint8Array(n.length);for(let e=0;e<n.length;++e)i[e]=n.charCodeAt(e);return new Blob([i],{type:a})},D=(e,t)=>new Promise(a=>{let n=new Image;n.onload=()=>{let e=n.naturalWidth,i=n.naturalHeight,o=e/i,c=e,s=i;o>t?c=i*t:o<t&&(s=e/t);let r=(c-e)*.5,l=(s-i)*.5,d=document.createElement("canvas");d.width=c,d.height=s;let u=d.getContext("2d");u.drawImage(n,r,l),a(d.toDataURL("image/jpeg"))},n.src=e}),W=(e,t,a)=>new Promise(n=>{l().imageFileResizer(e,t,a,"PNG",100,0,e=>{n(e)},"base64",t,a)});(0,i.useEffect)(()=>{(async()=>{let e=await navigator.mediaDevices.enumerateDevices(),t=e.filter(e=>"videoinput"==e.kind);_(t)})()}),(0,i.useEffect)(()=>{y.query.id&&x(y.query.id)},[k]);let A=()=>{let e="land";h.innerWidth>h.innerHeight?(N(16),I(9),e="land"):(N(9),I(16),e="port"),P("".concat("/immersive-camera","/images/characters/").concat(e,"-").concat(y.query.id,".png"))};return(0,i.useEffect)(()=>{void 0!==h&&(A(),h.onresize=function(){A()})},[C,j]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{id:"img_head_back",children:(0,n.jsxs)("div",{className:c().wrapper,children:[r?(0,n.jsx)("div",{className:c()["full-screen-image-preview"],style:{backgroundImage:"".concat(a?'url("'.concat(a,'")'):"")},image:a,onClick:()=>{m(!r),f("none"===b?"block":"none")}}):(0,n.jsx)(s.V,{ref:g,facingMode:"environment",aspectRatio:C/j,numberOfCamerasCallback:e=>t(e),videoSourceDeviceId:v,errorMessages:{noCameraAccessible:"No camera device accessible. Please connect your camera or try a different browser.",permissionDenied:"Permission denied. Please refresh and give camera permission.",switchCamera:"It is not possible to switch camera to different one because there is only one video device accessible.",canvas:"Canvas is not supported."},videoReadyCallback:()=>{console.log("Video feed ready.")}}),"block"===b&&(0,n.jsx)("div",{id:"img_head",className:c()["image-head"],children:(0,n.jsx)("img",{src:S,style:{width:"100%",height:"auto"}})}),(0,n.jsxs)("div",{className:c().control,children:[(0,n.jsx)("select",{style:{display:"none"},onChange:e=>{w(e.target.value)},children:p.map(e=>(0,n.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))}),(0,n.jsx)("div",{className:c()["image-preview"],style:{backgroundImage:"".concat(a?'url("'.concat(a,'")'):"")},image:a,onClick:()=>{m(!r),f("none"===b?"block":"none")}}),(0,n.jsx)("div",{className:"".concat(c().button," ").concat(c()["take-photo-button"]),onClick:async()=>{if(g.current){let e=g.current.takePhoto(),t=await D(e,C/j),a=new Image;a.onload=async()=>{let e=await E(S),n=R(e);try{let e=await W(n,a.width,a.height);(0,d.Z)([{src:t,x:0,y:0},{src:e,x:0,y:0}]).then(e=>{o(e)})}catch(e){console.log(e)}},a.src=t}}}),(0,n.jsx)("div",{className:"".concat(c().button," ").concat(c()["change-facing-camera-button"]),style:{visibility:"hidden"},disabled:e<=1,onClick:()=>{if(g.current){let e=g.current.switchCamera();console.log(e)}}})]})]})})})}},1894:function(e){e.exports={wrapper:"photo_wrapper__IpDW7","image-head":"photo_image-head__x_be_",control:"photo_control__zYJLd",button:"photo_button__iIxWf","take-photo-button":"photo_take-photo-button__7HxNy","change-facing-camera-button":"photo_change-facing-camera-button__GK3jp","image-preview":"photo_image-preview__NhJsK","full-screen-image-preview":"photo_full-screen-image-preview__K6WRY"}}},function(e){e.O(0,[78,774,888,179],function(){return e(e.s=3640)}),_N_E=e.O()}]);