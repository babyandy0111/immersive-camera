(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{3640:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/photo/[id]",function(){return t(4701)}])},7125:function(e,a,t){"use strict";var n=t(5893);t(7294);var o=t(8102),i=t(8575);let c={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg"},s={png:"data:".concat(c.png,";base64"),jpeg:"data:".concat(c.jpeg,";base64"),jpg:"data:".concat(c.jpg,";base64")},r="download",l=function(e){let{base64:a,children:t,downloadName:l,onDownloadSuccess:d,onDownloadError:u,Tag:g,className:m,style:p,extraAttributes:h}=e;return(0,n.jsx)(g,{...h,onClick:function(){try{(function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,t=function(e){let a;if("string"==typeof e&&(a=Object.keys(s).find(a=>0===e.indexOf(s[a]))),a)return a;throw Error("props.base64 on <Base64Downloader/> has invalid or undefined extension. expected ".concat(Object.keys(c).join(", ")))}(e),n=s[t],l=c[t],d=e.replace("".concat(n,","),""),u=i(d,l),g=new File([u],"".concat(a,".").concat(t),{type:n});o.saveAs(g)})(a,l),d&&d({base64:a})}catch(e){console.error(e),u&&u(e)}},className:m,style:p,children:t})};l.defaultProps={className:"",style:{},downloadName:r,Tag:"button",extraAttributes:{}},a.ZP=l},4701:function(e,a,t){"use strict";t.r(a);var n=t(5893),o=t(7294),i=t(1894),c=t.n(i),s=t(3041),r=t(6770),l=t.n(r),d=t(2481),u=t(1163),g=t(7125);let m={};m=window,a.default=()=>{let[e,a]=(0,o.useState)(0),[t,i]=(0,o.useState)(null),[r,p]=(0,o.useState)(!1),h=(0,o.useRef)(null),[b,w]=(0,o.useState)([]),[f,v]=(0,o.useState)(void 0),[_,y]=(0,o.useState)("block"),j=(0,u.useRouter)(),[x,k]=(0,o.useState)(""),[N,C]=(0,o.useState)(9),[P,I]=(0,o.useState)(16),[S,E]=(0,o.useState)("".concat("/immersive-camera","/images/characters/port-1.png")),R=async e=>{let a=await fetch(e),t=await a.blob(),n="";return await new Promise(e=>{let a=new FileReader;a.readAsDataURL(t),a.onloadend=()=>{e(n=a.result)}}),n},D=e=>{let a=e.split(";base64,"),t=a[0].split(":")[1],n=null==m?void 0:m.atob(a[1]),o=new Uint8Array(n.length);for(let e=0;e<n.length;++e)o[e]=n.charCodeAt(e);return new Blob([o],{type:t})},A=(e,a)=>new Promise(t=>{let n=new Image;n.onload=()=>{let e=n.naturalWidth,o=n.naturalHeight,i=e/o,c=e,s=o;i>a?c=o*a:i<a&&(s=e/a);let r=(c-e)*.5,l=(s-o)*.5,d=document.createElement("canvas");d.width=c,d.height=s;let u=d.getContext("2d");u.drawImage(n,r,l),t(d.toDataURL("image/jpeg"))},n.src=e}),O=(e,a,t)=>new Promise(n=>{l().imageFileResizer(e,a,t,"PNG",100,0,e=>{n(e)},"base64",a,t)});(0,o.useEffect)(()=>{(async()=>{let e=await navigator.mediaDevices.enumerateDevices(),a=e.filter(e=>"videoinput"==e.kind);w(a)})()}),(0,o.useEffect)(()=>{j.query.id&&k(j.query.id)},[x]);let W=()=>{let e="land";(null==m?void 0:m.innerWidth)>(null==m?void 0:m.innerHeight)?(C(16),I(9),e="land"):(C(9),I(16),e="port"),E("".concat("/immersive-camera","/images/characters/").concat(e,"-").concat(j.query.id,".png"))};return(0,o.useEffect)(()=>{void 0!==m&&(W(),m.onresize=function(){W()})},[N,P]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{id:"img_head_back",children:(0,n.jsxs)("div",{className:c().wrapper,children:[r?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:c()["full-screen-image-preview"],style:{backgroundImage:"".concat(t?'url("'.concat(t,'")'):"")},image:t,onClick:()=>{p(!r),y("none"===_?"block":"none")}}),(0,n.jsx)(g.ZP,{base64:t,downloadName:"photo".concat(x),className:c()["download-btn"],style:{backgroundImage:"url(".concat("/immersive-camera","/images/buttons/download.png)")},children:"下載照片"})]}):(0,n.jsx)(s.V,{ref:h,facingMode:"environment",aspectRatio:N/P,numberOfCamerasCallback:e=>a(e),videoSourceDeviceId:f,errorMessages:{noCameraAccessible:"No camera device accessible. Please connect your camera or try a different browser.",permissionDenied:"Permission denied. Please refresh and give camera permission.",switchCamera:"It is not possible to switch camera to different one because there is only one video device accessible.",canvas:"Canvas is not supported."},videoReadyCallback:()=>{console.log("Video feed ready.")}}),"block"===_&&(0,n.jsx)("div",{id:"img_head",className:c()["image-head"],children:(0,n.jsx)("img",{src:S,style:{width:"100%",height:"auto"}})}),(0,n.jsxs)("div",{className:c().control,children:[(0,n.jsx)("select",{style:{display:"none"},onChange:e=>{v(e.target.value)},children:b.map(e=>(0,n.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))}),(0,n.jsx)("div",{className:c()["image-preview"],style:{backgroundImage:"".concat(t?'url("'.concat(t,'")'):"")},image:t,onClick:()=>{p(!r),y("none"===_?"block":"none")}}),(0,n.jsx)("div",{className:"".concat(c().button," ").concat(c()["take-photo-button"]),onClick:async()=>{if(h.current){let e=h.current.takePhoto(),a=await A(e,N/P),t=new Image;t.onload=async()=>{let e=await R(S),n=D(e);try{let e=await O(n,t.width,t.height);(0,d.Z)([{src:a,x:0,y:0},{src:e,x:0,y:0}]).then(e=>{i(e)})}catch(e){console.log(e)}},t.src=a}}}),(0,n.jsx)("div",{className:"".concat(c().button," ").concat(c()["change-facing-camera-button"]),style:{visibility:"hidden"},disabled:e<=1,onClick:()=>{if(h.current){let e=h.current.switchCamera();console.log(e)}}})]})]})})})}},1894:function(e){e.exports={wrapper:"photo_wrapper__IpDW7","image-head":"photo_image-head__x_be_",control:"photo_control__zYJLd",button:"photo_button__iIxWf","download-btn":"photo_download-btn__VP6JA","take-photo-button":"photo_take-photo-button__7HxNy","change-facing-camera-button":"photo_change-facing-camera-button__GK3jp","image-preview":"photo_image-preview__NhJsK","full-screen-image-preview":"photo_full-screen-image-preview__K6WRY"}}},function(e){e.O(0,[359,774,888,179],function(){return e(e.s=3640)}),_N_E=e.O()}]);